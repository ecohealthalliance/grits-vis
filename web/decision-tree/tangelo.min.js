var tangelo={};(function(){"use strict";tangelo.version=function(){return"0.2.0"};tangelo.fatalError=function(t,e){if(e===undefined){e=t;throw new Error(e)}throw new Error("["+t+"] "+e)};tangelo.unavailable=function(t){var e=t.plugin,n=t.required,i,o;if(tangelo.isArray(n)){if(n.length===1){n=n[0]}else if(n.length===2){n=n[0]+" and "+n[1]}else{o="";for(i=0;i<n.length-1;i+=1){o+=n[i]+", "}o+="and "+n[n.length-1];n=o}}return function(){tangelo.fatalError("JavaScript include error: "+e+" requires "+n)}};tangelo.identity=function(t){return t};tangelo.isNumber=function(t){return typeof t==="number"};tangelo.isBoolean=function(t){return typeof t==="boolean"};tangelo.isArray=function(t){return Object.prototype.toString.call(t)==="[object Array]"};tangelo.isObject=function(t){return Object.prototype.toString.call(t)==="[object Object]"};tangelo.isString=function(t){return Object.prototype.toString.call(t)==="[object String]"};tangelo.isFunction=function(t){return Object.prototype.toString.call(t)==="[object Function]"};tangelo.absoluteUrl=function(t){if(t.length>0){if(t[0]!=="/"&&t[0]!=="~"){t=window.location.pathname+"/"+t}}return t};tangelo.accessor=function(t,e){var n;if(tangelo.isFunction(t)){return t}if(!t){return function(){return e}}if(t.hasOwnProperty("value")){return function(){return t.value}}if(t.hasOwnProperty("index")){return function(t,e){return e}}if(t.hasOwnProperty("field")){if(t.field==="."){return tangelo.identity}n=t.field.split(".");return function(t){var i;for(i=0;i<n.length;i+=1){t=t[n[i]];if(t===undefined){return e}}return t}}tangelo.fatalError("tangelo.accessor()","unknown accessor spec "+t)};tangelo.appendFunction=function(t,e){var n=this;if(!t){return e}if(!e){return t}return function(){t.apply(n,arguments);e.apply(n,arguments)}};tangelo.requireCompatibleVersion=function(t){var e,n,i,o,r=function(t){var e;for(e=0;e<t.length;e+=1){if(isNaN(t[e])){return true}}return false};i=t.split(".").map(function(t){return+t});if(i.length===0||i.length>3||r(i)){tangelo.fatalError("tangelo.requireCompatibleVersion()","illegal argument '"+t+"'")}for(e=i.length;e<3;e+=1){i[e]=0}n=tangelo.version().split(".").map(function(t){return+t});if(i[0]===0){o=n[0]===0&&i[1]===n[1]&&i[2]<=n[2]}else{o=i[0]===n[0]&&i[1]<=n[1]&&i[2]<=n[2]}return o}})(window.$);(function(t,e){"use strict";t.getStreams=function(t){e.ajax({url:"/stream",dataType:"json",error:function(e){t(undefined,e)},success:function(e){t(e)}})};t.startStream=function(n,i){n=t.absoluteUrl(n);e.ajax({url:n,dataType:"json",error:function(t){i(undefined,t)},success:function(t){i(t.stream_key)}})};t.queryStream=function(t,n){e.ajax({url:"/stream/"+t,dataType:"json",error:function(t){n(undefined,t)},success:function(t){if(t.error){console.warn("[tangelo.queryStream] error: "+t.error);return}n(t)}})};t.runStream=function(n,i,o){if(o===undefined){o=100}e.ajax({url:"/stream/"+n,dataType:"json",error:function(t){console.warn("[tangelo.runStream] error: ajax call failed; aborting runStream operation");i(undefined,t)},success:function(e){var r,s=true;if(e.error){console.warn("[tangelo.runStream] error: "+e.error+"; aborting runStream operation");return}r=i(e);if(r!==undefined){if(t.isFunction(r)){i=r}else if(t.isBoolean(r)){s=r}else if(t.isNumber(r)){o=r}}if(s){window.setTimeout(t.runStream,o,n,i,o)}}})};t.deleteStream=function(t,n){e.ajax({url:"/stream/"+t,dataType:"json",type:"DELETE",error:function(t){if(n){n(undefined,t)}},success:function(t){if(n){n(t)}}})}})(window.tangelo,window.$);(function(t,e){"use strict";t.allDefined=function(){var t;for(t=0;t<arguments.length;t+=1){if(arguments[t]===undefined){return false}}return true};if(!e){t.defaults=t.unavailable({plugin:"tangelo.defaults",required:"JQuery"})}t.defaults=function(t,n){if(t.length>0){if(t[0]!=="/"&&t[0]!=="~"){t=window.location.pathname+"/"+t}}e.ajax({url:"/service/defaults",data:{path:t},dataType:"json",error:function(t){n(undefined,undefined,t)},success:function(t){if(t.error){n(undefined,undefined,t.error)}else{n(t.result,t.status)}}})};t.uniqueID=function(){var t={"":true},e="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";return function(n){var i="",o;n=n||6;while(t.hasOwnProperty(i)){i="";for(o=0;o<n;o+=1){i+=e[Math.floor(Math.random()*52)]}}t[i]=true;return i}}();t.queryArguments=function(){var t={},e,n,i;if(window.location.search.length>1){for(n=0,i=window.location.search.substr(1).split("&");n<i.length;n+=1){e=i[n].split("=");t[decodeURI(e[0])]=e.length>1?decodeURI(e[1]):""}}return t}})(window.tangelo,window.jQuery);window.tangelo.vegaspec={};tangelo.vegaspec.geovis=function(t){var e={width:800,height:800,data:[{name:"countries",url:null,format:{type:"topojson",feature:"countries"}},{name:"links",transform:[{type:"copy",from:"data",fields:["source","target"]}]},{name:"filter"},{name:"table",transform:[{type:"force",links:"links",iterations:0},{type:"geo",lat:"data.latitude",lon:"data.longitude",projection:"azimuthalEqualArea",clipAngle:179.99,scale:200,translate:[400,400],precision:.1}]}],scales:[{name:"color",type:"ordinal",range:"category10"},{name:"size",type:"linear",range:[100,400],zero:false,domain:{data:"table",field:"data.size"}}],legends:[{fill:"color",orient:"left",properties:{labels:{fontSize:{value:18}},symbols:{size:{value:100},stroke:{value:"#fff"}}}}],marks:[{type:"path",from:{data:"countries",transform:[{type:"geopath",value:"data",projection:"azimuthalEqualArea",clipAngle:179.99,scale:200,translate:[400,400],precision:.1}]},properties:{enter:{stroke:{value:"#fff"},path:{field:"path"}},update:{fill:{value:"#ccc"}}}},{type:"path",from:{data:"links",transform:[{type:"link",shape:"curve"}]},properties:{update:{path:{field:"path"},stroke:{value:"black"},strokeOpacity:{value:1},strokeWidth:{value:1}}}},{type:"symbol",from:{data:"table"},properties:{enter:{x:{field:"x"},y:{field:"y"}},update:{stroke:{value:"#fff"},fill:{scale:"color",field:"data.color"},size:{scale:"size",field:"data.size"}}}}]};e.data[0].url=t;return e};(function(t,e,n){"use strict";if(!(e&&n)){t.unavailable({plugin:"controlPanel",required:["JQuery","d3"]});return}function i(i,o){var r,s,a,l,c;r=n.select(i);s=n.select(o);a="uncollapsed";c="23px";function d(){l=e(r.node()).height()+"px"}window.setTimeout(d,1e3);return function(){if(a==="uncollapsed"){r.transition().duration(500).style("height",c);s.classed("icon-chevron-down",false).classed("icon-chevron-up",true);a="collapsed"}else if(a==="collapsed"){r.transition().duration(500).style("height",l);s.classed("icon-chevron-down",true).classed("icon-chevron-up",false);a="uncollapsed"}else{t.fatalError("drawerToggle()","illegal state: "+a)}}}e.fn.controlPanel=function(){var e,o,r,s;o=n.select(this[0]);if(o.empty()){return}s=t.uniqueID();r=o.attr("id");if(!r){r="tangelo-control-panel-"+s;o.attr("id",r)}o.style("position","fixed").style("bottom","0px").style("width","100%").insert("div",":first-child").attr("id","tangelo-drawer-handle-"+s).style("text-align","center").style("cursor","pointer").on("mouseenter",function(){n.select(this).style("background","gray")}).on("mouseleave",function(){n.select(this).style("background",null)}).append("i").attr("id","tangelo-drawer-icon-"+s).classed("icon-chevron-down",true);e=i("#"+r,"#tangelo-drawer-icon-"+s);n.select("#tangelo-drawer-handle-"+s).on("click",e)}})(window.tangelo,window.jQuery,window.d3);(function(t,e,n,i){"use strict";if(!(e&&n&&i)){t.GoogleMapSVG=t.unavailable({plugin:"GoogleMapSVG",required:["JQuery","Google Maps API","d3"]});return}t.GoogleMapSVG=function(o,r,s,a){var l,c,d;this.id="gmsvg-"+t.uniqueID();this.mapdiv=i.select(o).append("div").attr("id",this.id).style("width",e(o).width()+"px").style("height",e(o).height()+"px").node();this.map=new n.maps.Map(this.mapdiv,r);this.setMap(this.map);this.size={width:e(this.mapdiv).width(),height:e(this.mapdiv).height()};l=this;e(this.mapdiv).resize(function(){n.maps.event.trigger(this.map,"resize")});this.cfg=s||{};if(a){n.maps.event.addListenerOnce(this.map,"idle",function(){a(l)})}};t.GoogleMapSVG.prototype=new n.maps.OverlayView;t.GoogleMapSVG.prototype.getSVG=function(){return this.svg.node()};t.GoogleMapSVG.prototype.getMap=function(){return this.map};t.GoogleMapSVG.prototype.computeCBArgs=function(){var t;t=i.select("#"+this.id+" [style*='webkit-transform: matrix']").style("-webkit-transform").split(" ").map(function(t,e){var n;if(e===0){n=t.slice("matrix(".length,-1)}else{n=t.slice(0,-1)}return n});return{svg:this.svg.node(),projection:this.getProjection(),zoom:this.map.getZoom(),translation:{x:t[4],y:t[5]},transform:t,zooming:t[0]!=="1"||t[3]!=="1"}};t.GoogleMapSVG.prototype.attachListener=function(i,o,r){var s=this,a;if(Object.prototype.toString.call(i)==="[object Array]"){e.each(i,function(t,e){s.attachListener(e,o,r)});return}if(r==="once"){a=n.maps.event.addListenerOnce}else if(r==="always"){a=n.maps.event.addListener}else{t.fatalError("GoogleMapSVG.attachListener()","illegal value for argument 'how'")}a(this.map,i,function(){var t=s.computeCBArgs();if(i==="draw"){if(t.zooming){window.setTimeout(n.maps.event.trigger,100,s.map,"draw")}}o.call(s,t)})};t.GoogleMapSVG.prototype.on=function(t,e){this.attachListener(t,e,"always")};t.GoogleMapSVG.prototype.onceOn=function(t,e){this.attachListener(t,e,"once")};t.GoogleMapSVG.prototype.trigger=function(t){n.maps.event.trigger(this.map,t)};t.GoogleMapSVG.prototype.shift=function(t,e,n){i.select(t).style("-webkit-transform","translate("+e+"px, "+n+"px)")};t.GoogleMapSVG.prototype.onAdd=function(){this.svg=i.select(this.getPanes().overlayMouseTarget).append("svg").attr("width",this.size.width).attr("height",this.size.height);if(this.cfg.initialize){this.cfg.initialize.call(this,this.svg.node(),this.getProjection(),this.map.getZoom())}};t.GoogleMapSVG.prototype.draw=function(){}})(window.tangelo,window.jQuery,window.google,window.d3);(function(t,e,n){"use strict";if(!(e&&n)){e.fn.svgColorLegend=t.unavailable({plugin:"svgColorLegend",required:["JQuery","d3"]});return}e.fn.svgColorLegend=function(t){var i,o,r,s,a,l,c,d,u,p,h,f,g,y,v,m,w,x,b,_,k,S,z,O;m=t.cmap_func;w=t.xoffset;x=t.yoffset;b=t.categories;_=t.height_padding;k=t.width_padding;S=t.text_spacing;z=t.legend_margins;O=t.clear;v=n.select(this[0]);O=O||false;if(O){v.selectAll("*").remove()}d=0;c=0;o=v.append("rect").style("fill","white").style("opacity",.7);e.each(b,function(t,e){v.append("rect").classed("colorbox",true).attr("x",w).style("fill",m(e));p=v.append("text").classed("legendtext",true).text(e);i=p[0][0].getBBox();if(i.width>d){d=i.width}if(i.height>c){c=i.height}});s=c+_;y=s;f=s*b.length;g=y+k+d;l=z.left||0;h=z.top||0;u=z.right||0;r=z.bottom||0;o.attr("x",w-l||0).attr("y",x-h||0).attr("width",l+g+u).attr("height",h+f+r);a=function(t,e){return x+e*s};v.selectAll(".colorbox").attr("width",s).attr("height",s).attr("y",a);v.selectAll(".legendtext").attr("x",w+y+k).attr("y",function(t,e){return S+a(t,e)})}})(window.tangelo,window.jQuery,window.d3);(function(t,e,n){"use strict";if(!(e&&e.widget&&n)){e.fn.dendrogram=t.unavailable({plugin:"dendrogram",required:["JQuery","JQuery UI","d3"]});return}e.widget("tangelo.dendrogram",{options:{label:t.accessor({value:""}),distance:t.accessor({value:1}),id:t.accessor({value:0}),margin:{top:20,right:120,bottom:20,left:120},nodeLimit:null,duration:750,root:null,source:null,data:null,mode:"hide",nodesize:7.5,textsize:10,orientation:"horizontal",lineStyle:"curved",nodeColor:t.accessor({value:"lightsteelblue"}),nodeOpacity:t.accessor({value:1}),hoverNodeColor:t.accessor({value:"green"}),hoverNodeOpacity:t.accessor({value:1}),selectedNodeColor:t.accessor({value:"firebrick"}),selectedNodeOpacity:t.accessor({value:1}),collapsedNodeColor:t.accessor({value:"blue"}),collapsedNodeOpacity:t.accessor({value:1}),onNodeCreate:null,onNodeDestroy:null},_notAccessors:["margin","nodeLimit","duration","root","source","data","mode","nodesize","textsize","orientation","lineStyle","onNodeCreate","onNodeDestroy"],_actions:{collapse:null},action:function(t){return this._actions[t]},orientation:{abscissa:"y",ordinate:"x",heightvar:"height",widthvar:"width",xfunc:function(t,e){return e}},_lineStyle:function(t,e){return this.line({source:t,target:e})},_create:function(){var i,o=this;this._actions.collapse=function(t){if(o.options.mode==="hide"){if(t.children){t._children=t.children;t.children=null;t.collapsed=true;n.select(this).select("circle").style("fill",o.options.collapsedNodeColor).style("opacity",o.options.collapsedNodeOpacity).classed("children-hidden",true)}else{t.children=t._children;t._children=null;t.collapsed=false;n.select(this).select("circle").style("fill",o.options.nodeColor).style("opacity",o.options.nodeOpacity).classed("children-hidden",false)}}else if(o.options.mode==="focus"){o.options.root=t}else if(o.options.mode==="label"){t.showLabel=t.showLabel?false:true}o._setOptions({source:t})};if(this.options.orientation==="vertical"){this.orientation={abscissa:"x",ordinate:"y",heightvar:"width",widthvar:"height",xfunc:function(t,e){var n=(t.xminmax[0]+t.xminmax[1])/2;return 2*n-e}}}else if(this.options.orientation!=="horizontal"){t.fatalError("$.dendrogram()","illegal option for 'orientation': "+this.options.orientation)}this.tree=n.layout.partition().value(function(){return 1}).sort(n.ascending);this.line=null;if(this.options.lineStyle==="curved"){this.line=n.svg.diagonal().projection(function(t){return[o.orientation.xfunc(o,t[o.orientation.abscissa]),t[o.orientation.ordinate]]})}else if(this.options.lineStyle==="axisAligned"){this.line=n.svg.line().interpolate("step-before").x(function(t){return o.orientation.xfunc(o,t[o.orientation.abscissa])}).y(function(t){return t[o.orientation.ordinate]});this._lineStyle=function(t,e){return o.line([t,e])}}else{t.fatalError("$.dendrogram()","illegal option for 'lineStyle': "+this.options.lineStyle)}this.svg=n.select(this.element.get(0)).append("svg").append("g");i=e.extend(true,{},this.options);delete i.disabled;delete i.create;this._setOptions(i)},_setOption:function(e,n){if(this._notAccessors.indexOf(e)===-1){this._super(e,t.accessor(n))}else{this._super(e,n)}},_setOptions:function(t){var n=this;e.each(t,function(t,e){n._setOption(t,e)});this._update()},_update:function(){this.width=1200-this.options.margin.right-this.options.margin.left;this.height=800-this.options.margin.top-this.options.margin.bottom;if(!this.options.root){this.options.root=this.options.data}if(!this.options.mode){this.options.mode="hide"}this.tree.size([this.height,this.width]);n.select(this.element.get(0)).select("svg").attr("width",this[this.orientation.widthvar]+this.options.margin.right+this.options.margin.left).attr("height",this[this.orientation.heightvar]+this.options.margin.top+this.options.margin.bottom).select("g").attr("transform","translate("+this.options.margin.left+","+this.options.margin.top+")");this.options.root.x0=this[this.orientation.heightvar]/2;this.options.root.y0=0;var t=this.tree.nodes(this.options.root).reverse(),e=this.tree.links(t),i=this.options.source||this.options.root,o,r,s,a,l,c,d,u,p,h,f=this;d=0;function g(t,e){var n=0;t.y=e;t.x=t.x+t.dx/2;if(!t.parent){t.parent=t}if(t.children){t.children.forEach(function(i){i.parent=t;g(i,e+10*f.options.distance(i));n+=i.x});t.x=n/t.children.length}else{d+=1}}g(this.options.root,0);function y(t){var e,n,i;e=t;while(e.children&&e.children[0]){e=e.children[0]}n=t;while(n.children&&n.children[1]){n=n.children[1]}return[e.x,n.x]}this.xminmax=y(this.options.root);c=n.extent(t,function(t){return t.y})[1];t.forEach(function(t){t.y=t.y/c*(f.width-150)});if(this.options.nodeLimit&&t.length>this.options.nodeLimit){t.sort(function(t,e){return n.ascending(t.parent.y,e.parent.y)});t.forEach(function(t,e){t.index=e});u=t.slice(0,this.options.nodeLimit);c=u[u.length-1].parent.y;u.forEach(function(t){t.y=t.y>c?c:t.y});p=[];e.forEach(function(t){if(t.source.index<this.options.nodeLimit&&t.target.index<this.options.nodeLimit){p.push(t)}});t=u;e=p}function v(t){if(t.children){return v(t.children[0])}if(t._children){return v(t._children[0])}return t}function m(t){if(t.children){return m(t.children[t.children.length-1])}if(t._children){return m(t._children[t._children.length-1])}return t}function w(t){var e=t.children,n=0;if(!e){e=t._children}if(e){e.forEach(function(t){n+=w(t)});return n}return 1}o=this.svg.selectAll("g.node").data(t,function(t){return f.options.id(t)});r=o.enter().append("g").classed("node",true).attr("transform",function(){return"translate("+f.orientation.xfunc(f,i[f.orientation.abscissa+"0"])+","+i[f.orientation.ordinate+"0"]+")"});r.append("circle").attr("r",1e-6).classed("node",true).style("fill",this.options.nodeColor).style("opacity",this.options.nodeOpacity).style("stroke","black").style("stroke-width","1px").on("mouseenter.tangelo",function(){n.select(this).style("fill",f.options.hoverNodeColor).style("opacity",f.options.hoverNodeOpacity)}).on("mouseleave.tangelo",function(t){n.select(this).style("fill",t.collapsed?f.options.collapsedNodeColor:f.options.nodeColor).style("opacity",t.collapsed?f.options.collapsedNodeOpacity:f.options.nodeOpacity)});r.append("text").attr("x",10).attr("dy",".35em").attr("text-anchor","start").style("font-size",this.options.textsize+"px").text(this.options.label).style("fill-opacity",1e-6);s=o.transition().duration(this.options.duration).attr("transform",function(t){return"translate("+f.orientation.xfunc(f,t[f.orientation.abscissa])+","+t[f.orientation.ordinate]+")"});s.select("circle").attr("r",this.options.nodesize);s.select("text").text(function(t){var e=f.options.label(t);if(d<f.height/(.8*f.options.textsize)){return e}return""}).style("fill-opacity",1);a=o.exit().transition().duration(this.options.duration).attr("transform",function(){return"translate("+f.orientation.xfunc(f,i[f.orientation.abscissa])+","+i[f.orientation.ordinate]+")"}).remove();a.select("circle").attr("r",1e-6);a.select("text").style("fill-opacity",1e-6);l=this.svg.selectAll("path.link").data(e,function(t){return f.options.id(t.target)});l.enter().insert("path","g").classed("link",true).style("stroke","black").style("stroke-width","1px").style("fill","none").attr("d",function(){var t={x:i.x0,y:i.y0};return f._lineStyle(t,t)});l.transition().duration(this.options.duration).attr("d",function(t){return f._lineStyle(t.source,t.target)});l.exit().transition().duration(this.options.duration).attr("d",function(){var t={x:i.x,y:i.y};return f._lineStyle(t,t)}).remove();t.forEach(function(t){t.x0=t.x;t.y0=t.y});if(this.options.onNodeDestroy){a.each(this.options.onNodeDestroy)}if(this.options.onNodeCreate){r.each(this.options.onNodeCreate)}for(h in this._eventHandlers){if(this._eventHandlers.hasOwnProperty(h)){this.on(h,this._eventHandlers[h])}}},on:function(t,e){var n=this;n.svg.selectAll("g.node").selectAll("circle").on(t,e?function(t,i){e.call(n,t,i,this)}:null);if(e!==null){this._eventHandlers[t]=e}else{delete this._eventHandlers[t]}},_eventHandlers:{},download:function(t){var e,i,o,r;if(t==="pdf"){e=this.svg.selectAll("g.node").select("circle").attr("r",function(t){return t._children?this.options.nodesize:0});i=new window.XMLSerializer;o=n.select("svg").node();r=i.serializeToString(o);e.attr("r",this.options.nodesize);n.json("/service/svg2pdf").send("POST",r,function(t,e){window.location="/service/svg2pdf?id="+e.result})}else{window.alert("Unsupported export format type: "+t)}},reset:function(){function t(e){if(!e.children){e.children=e._children;e._children=null}if(e.children){e.children.forEach(t)}}t(this.options.data);this._setOptions({root:this.options.data})}})})(window.tangelo,window.jQuery,window.d3);(function(t,e,n){"use strict";if(!(e&&e.widget&&n)){e.fn.geodots=t.unavailable({plugin:"geodots",required:["JQuery","JQuery UI","Vega"]});return}e.widget("tangelo.geodots",{options:{latitude:null,longitude:null,size:null,color:null,data:null},_missing:{latitude:0,longitude:0,size:20,color:0},_create:function(){var i=this,o=t.vegaspec.geovis(i.options.worldGeometry);n.parse.spec(o,function(t){var n;i.vis=t;n=e.extend(true,{},i.options);delete n.disabled;delete n.create;delete n.worldGeometry;i._setOptions(n)})},_setOption:function(e,n){if(e!=="data"){this._super(e,t.accessor(n,this._missing[e]))}else{this._super(e,n)}},_setOptions:function(t){var n=this;e.each(t,function(t,e){n._setOption(t,e)});this._update()},_update:function(){var t=this;if(this.options.data){this.options.data.forEach(function(e){e.latitude=t.options.latitude(e);e.longitude=t.options.longitude(e);e.size=t.options.size(e);e.color=t.options.color(e)});this.vis({el:t.element.get(0),data:{table:t.options.data,links:[]}}).update()}}})})(window.tangelo,window.jQuery,window.vg);(function(t,e,n){"use strict";if(!(e&&e.widget&&n)){e.fn.geonodelink=t.unavailable({plugin:"geonodelink",required:["JQuery","JQuery UI","Vega"]});return}e.widget("tangelo.geonodelink",{options:{nodeLatitude:null,nodeLongitude:null,nodeSize:null,nodeColor:null,linkColor:null,linkSource:null,linkTarget:null,data:null},_missing:{nodeLatitude:0,nodeLongitude:0,nodeSize:20,nodeColor:0,linkColor:0,linkSource:0,linkTarget:0,data:null},_create:function(){var i=this,o=t.vegaspec.geovis(i.options.worldGeometry);n.parse.spec(o,function(t){var n;i.vis=t;n=e.extend(true,{},i.options);delete n.disabled;delete n.create;delete n.worldGeometry;i._setOptions(n)})},_setOption:function(e,n){if(e!=="data"){this._super(e,t.accessor(n,this._missing[e]))}else{this._super(e,n)}},_setOptions:function(t){var n=this,i=false;e.each(t,function(t,e){n._setOption(t,e)});this._update()},_update:function(){var t=this;e.each(this.options.data.nodes,function(e,n){var i=t.options.data.nodes[e];i.latitude=t.options.nodeLatitude(i);i.longitude=t.options.nodeLongitude(i);i.size=t.options.nodeSize(i);i.color=t.options.nodeColor(i)});e.each(this.options.data.links,function(e,n){var i=t.options.data.links[e];i.color=t.options.linkColor(i);i.source=t.options.linkSource(i);i.target=t.options.linkTarget(i)});t.vis({el:this.element.get(0),data:{table:t.options.data.nodes,links:t.options.data.links}}).update()}})})(window.tangelo,window.jQuery,window.vg);(function(t,e,n,i){"use strict";if(!(e&&i&&i.widget&&n)){i.fn.mapdots=t.unavailable({plugin:"mapdots",required:["Google Maps API","JQuery","JQuery UI","d3"]});return}i.widget("tangelo.mapdots",{options:{hoverContent:null,size:null,color:null,latitude:null,longitude:null,opacity:null,data:null},_missing:{hoverContent:"",size:1,color:"",latitude:0,longitude:0,opacity:1},_create:function(){var t=this.element.get(0),o=this,r,s;this.map=new e.maps.Map(t,{zoom:2,center:new e.maps.LatLng(0,0),mapTypeId:e.maps.MapTypeId.TERRAIN});n.select(t).style("width","100%").style("height","100%");i(t).resize(function(){e.maps.event.trigger(o.map,"resize")});this.overlay=new e.maps.OverlayView;this.overlay.onAdd=function(){var t;o.layer=n.select(this.getPanes().overlayMouseTarget).append("div").style("position","absolute");o.colorScale=n.scale.category10();this.draw=function(){var t,e=o.transform(this.getProjection());t=o.layer.selectAll("svg").data(o.options.data).each(e);t.enter().append("svg").each(e).attr("class","marker").style("cursor","crosshair").style("position","absolute").append("circle");n.selectAll("svg > circle").data(o.options.data).attr("r",function(t){return o.sizeScale(o.options.size(t))}).attr("cx",function(t){return o.sizeScale(o.options.size(t))+2}).attr("cy",function(t){return o.sizeScale(o.options.size(t))+2}).style("fill",function(t){return o.colorScale(o.options.color(t))}).style("opacity",function(t){return o.options.opacity(t)}).each(function(t){var e,n=o.options.hoverContent(t);if(!n){return}e={html:true,container:"body",placement:"top",trigger:"hover",content:o.options.hoverContent(t),delay:{show:0,hide:0}};i(this).popover(e)});t.exit().remove()};this.onRemove=function(){}};s=i.extend(true,{},this.options);delete s.disabled;delete s.create;this._setOptions(s);this.overlay.setMap(this.map)},_setOption:function(e,n){if(e!=="data"){this._super(e,t.accessor(n,this._missing[e]))}else{this._super(e,n)}},_setOptions:function(t){var e=this;i.each(t,function(t,n){e._setOption(t,n)});this._update()},_update:function(){var t=this;this.sizeScale=n.scale.sqrt().domain(n.extent(this.options.data,this.options.size)).range([5,15]);this.transform=function(i){return function(o){var r=t.sizeScale(t.options.size(o));o=new e.maps.LatLng(t.options.latitude(o),t.options.longitude(o));o=i.fromLatLngToDivPixel(o);return n.select(this).style("left",o.x-r-2+"px").style("top",o.y-r-2+"px").style("width",2*r+4+"px").style("height",2*r+4+"px")}};if(this.overlay.draw){this.overlay.draw()}}})})(window.tangelo,window.google,window.d3,window.jQuery);(function(t,e,n){"use strict";if(!(e&&e.widget&&n)){e.fn.nodelink=t.unavailable({plugin:"nodelink",required:["JQuery","JQuery UI","d3"]});return}e.widget("tangelo.nodelink",{options:{nodeCharge:t.accessor({value:-130}),nodeColor:t.accessor({value:"steelblue"}),nodeSize:t.accessor({value:10}),nodeLabel:t.accessor({value:""}),nodeOpacity:t.accessor({value:1}),nodeId:t.accessor({index:true}),linkSource:t.accessor({field:"source"}),linkTarget:t.accessor({field:"target"}),linkDistance:t.accessor({value:30}),linkOpacity:t.accessor({value:.2}),width:1e3,height:1e3,dynamicLabels:false,data:null},_notAccessors:["data","width","height","dynamicLabels"],_create:function(){var t;this.colorScale=n.scale.category10();this.force=n.layout.force();this.svg=n.select(this.element.get(0)).append("svg");t=e.extend(true,{},this.options);t.data=this.options.data;delete t.disabled;delete t.create;this._setOptions(t)},_setOption:function(e,n){if(this._notAccessors.indexOf(e)===-1){this._super(e,t.accessor(n))}else{this._super(e,n)}},_setOptions:function(t){var n=this;e.each(t,function(t,e){n._setOption(t,e)});this._update()},_update:function(){var t=this,e={};if(this.options.nodeX){this.xScale=n.scale.linear().domain(n.extent(this.options.data.nodes,this.options.nodeX)).range([50,this.options.width-100])}if(this.options.nodeY){this.yScale=n.scale.linear().domain(n.extent(this.options.data.nodes,this.options.nodeY)).range([this.options.height-100,50])}this.force.linkDistance(this.options.linkDistance).charge(this.options.nodeCharge).size([this.options.width,this.options.height]);this.options.data.nodes.forEach(function(n,i){e[t.options.nodeId(n,i)]=n;n.degree=0;n.outgoing=[];n.incoming=[]});this.options.data.links.forEach(function(n,i){n.source=e[t.options.linkSource(n,i)];n.target=e[t.options.linkTarget(n,i)];n.source.degree+=1;n.target.degree+=1;n.source.outgoing.push(n.target);n.target.incoming.push(n.source)});this.options.data.nodes.sort(function(t,e){return n.descending(t.degree,e.degree)});this.sizeScale=n.scale.sqrt().domain(n.extent(this.options.data.nodes,t.options.nodeSize)).range([5,15]);this.force.size([this.options.width,this.options.height]).nodes(this.options.data.nodes).links(this.options.data.links).start();this.link=this.svg.selectAll(".link").data(this.options.data.links);this.link.enter().append("line").classed("link",true).style("opacity",this.options.linkOpacity).style("stroke","black").style("stroke-width",1);this.node=this.svg.selectAll(".node").data(this.options.data.nodes);this.node.enter().append("circle").classed("node",true).call(this.force.drag).append("title");this.node.attr("r",function(e,n){return t.sizeScale(t.options.nodeSize(e,n))}).style("fill",function(e,n){return t.colorScale(t.options.nodeColor(e,n))}).style("opacity",this.options.nodeOpacity);this.node.selectAll("title").text(this.options.nodeLabel);if(!t.options.dynamicLabels){this.label=this.svg.selectAll("text").data(this.options.data.nodes);this.label.enter().append("text").text(this.options.nodeLabel)}this.force.on("tick",function(){t._tick.call(t)});this.force.resume()},_tick:function(){var t=this,e;if(t.options.nodeX){t.options.data.nodes.forEach(function(e,n){e.x=t.xScale(t.options.nodeX(e,n))})}if(t.options.nodeY){t.options.data.nodes.forEach(function(e,n){e.y=t.yScale(t.options.nodeY(e,n))})}if(t.options.dynamicLabels){e=t._nodeLabels();t.svg.selectAll("text").remove();t.svg.selectAll("text").data(e).enter().append("text").attr("x",function(t){return t.x}).attr("y",function(t){return t.y}).style("font-size",function(t){return t.count+8}).text(function(t){return t.label})}else{t.label.attr("x",function(t){return t.x}).attr("y",function(t){return t.y})}t.link.attr("x1",function(t){return t.source.x}).attr("y1",function(t){return t.source.y}).attr("x2",function(t){return t.target.x}).attr("y2",function(t){return t.target.y});t.node.attr("cx",function(t){return t.x}).attr("cy",function(t){return t.y})},_nodeLabels:function(){var t=this,e=[];t.options.data.nodes.forEach(function(t){t.visited=false});t.options.data.nodes.forEach(function(n,i){var o=0,r=[],s;function a(e){if(e.visited){return}if(Math.abs(e.x-n.x)<50&&Math.abs(e.y-n.y)<50){o+=1;r.push(t.options.nodeLabel(e,i));e.visited=true;e.incoming.forEach(a);e.outgoing.forEach(a)}}a(n);if(o>1){s=t._reduceLabels(r);e.push({count:o,label:s,x:n.x,y:n.y})}});return e},_reduceLabels:function(t){var e="",n={},i,o,r;t.forEach(function(t){var e,i=n;e=t.split(" ");while(e.length>0){if(!i[e[0]]){i[e[0]]={count:0,next:{}}}i[e[0]].count+=1;i=i[e[0]].next;e=e.slice(1)}});while(true){o=0;r=0;for(i in n){if(n.hasOwnProperty(i)){if(n[i].count>o){o=n[i].count;r=i}}}if(o<2){break}e+=" "+r;n=n[r].next}return e}})})(window.tangelo,window.jQuery,window.d3);window.tangelo.data={};(function(t){"use strict";t.data.tree=function(e){var n=t.accessor(e.id,""),i=t.accessor(e.idChild,""),o=t.accessor(e.children),r=e.data,s={},a;r.forEach(function(t){s[n(t)]=t});r.forEach(function(t){if(o(t)){t.children=[];o(t).forEach(function(e){var n=s[i(e)];n.hasParent=true;t.children.push(n)})}});r.forEach(function(t){if(!t.hasParent){a=t}delete t.hasParent});return a}})(window.tangelo);